### 事务

**事务**`Transaction`是[数据库管理系统](https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F)执行过程中的一个逻辑单位，由一个有限的[数据库](https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E5%BA%93)操作序列构成。

数据库的事务是保证数据完整性的一种机制，简而言之，就是怎样确保数据的执行过程要么都成功，要么都失败，举例子为假设你要给银行还款，需要从你的银行卡中扣除相关的金额也需要在你的信用卡上加钱，这个流程务必是一个完整的流程，不能拆分，如果从你的银行卡中扣除了钱，但是加钱的流程是失败的，这个时候用户是吃亏的，反之银行则会亏本，所以这就涉及到了事务的机制。

#### ACID

+ **原子性Atomic**：一个事务（transaction）中的所有操作，要么全部完成，要么全部不完成，不会结束在中间某个环节。事务在执行过程中发生错误，会被回滚（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。
+ **一致性Consistency**：事务应确保数据库的状态从一个一致状态转变为另一个一致状态。一致状态的含义是数据库中的数据应满足完整性约束。
+ **隔离性Isolation**：多个事务并发执行时，一个事务的执行不应影响其他事务的执行。
+ **持久性Durability**：事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。

> [如何理解数据库事务中的一致性的概念？ - 沈询的回答 - 知乎](https://www.zhihu.com/question/31346392/answer/156411587)
>
> 原子性：记录之前的版本，允许回滚
>
> 一致性：事务开始和结束之间的中间状态不会被其他事务看到
>
> 隔离性：适当的破坏一致性来提升性能与并行度  例如：最终一致~=读未提交。
>
> 持久性：每一次的事务提交后就会保证不会丢失

#### JDBC中使用事务

JDBC的一切行为包括事务是基于一个`Connection`的，在JDBC中是通过`Connection`对象进行事务管理。在JDBC中，常用的和事务相关的方法是： `setAutoCommit`、`commit`、`rollback`等。

```java
connection.setAutoCommit(false);// 打开事务

connection.commit();// 提交事务

connection.rollback();// 回滚事务
```



